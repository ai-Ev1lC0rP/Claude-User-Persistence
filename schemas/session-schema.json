{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://schemas.claude-persistence.local/session-schema.json",
  "title": "Claude Session State",
  "description": "Schema for active Claude session state management",
  "type": "object",
  "properties": {
    "session_info": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "description": "Unique session identifier"
        },
        "start_time": {
          "type": "string",
          "format": "date-time",
          "description": "When session started"
        },
        "last_activity": {
          "type": "string",
          "format": "date-time",
          "description": "Last activity timestamp"
        },
        "machine_id": {
          "type": "string",
          "description": "Machine identifier where session is active"
        },
        "claude_version": {
          "type": "string",
          "description": "Claude version being used"
        },
        "interface": {
          "type": "string",
          "enum": ["web", "desktop", "api", "mobile"],
          "description": "Interface being used"
        }
      },
      "required": ["id", "start_time", "machine_id", "interface"],
      "additionalProperties": false
    },
    "working_directory": {
      "type": "object",
      "properties": {
        "current_path": {
          "type": "string",
          "description": "Current working directory"
        },
        "project_root": {
          "type": "string",
          "description": "Project root directory"
        },
        "recent_files": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "path": {
                "type": "string",
                "description": "File path"
              },
              "last_accessed": {
                "type": "string",
                "format": "date-time"
              },
              "operation": {
                "type": "string",
                "enum": ["read", "write", "edit", "create", "delete"],
                "description": "Last operation performed"
              }
            },
            "required": ["path", "last_accessed", "operation"]
          },
          "maxItems": 20,
          "description": "Recently accessed files"
        },
        "bookmarks": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string",
                "description": "Bookmark name"
              },
              "path": {
                "type": "string",
                "description": "Directory or file path"
              },
              "description": {
                "type": "string",
                "description": "Optional description"
              },
              "created_at": {
                "type": "string",
                "format": "date-time"
              }
            },
            "required": ["name", "path", "created_at"]
          }
        }
      },
      "required": ["current_path"],
      "additionalProperties": false
    },
    "active_context": {
      "type": "object",
      "properties": {
        "context_id": {
          "type": "string",
          "format": "uuid",
          "description": "Reference to active context document"
        },
        "conversation_turns": {
          "type": "number",
          "minimum": 0,
          "description": "Number of conversation turns in current session"
        },
        "token_usage": {
          "type": "object",
          "properties": {
            "input_tokens": {
              "type": "number",
              "minimum": 0
            },
            "output_tokens": {
              "type": "number",
              "minimum": 0
            },
            "total_tokens": {
              "type": "number",
              "minimum": 0
            }
          },
          "required": ["input_tokens", "output_tokens", "total_tokens"]
        },
        "current_focus": {
          "type": "string",
          "description": "Current focus area or task"
        },
        "breadcrumbs": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "timestamp": {
                "type": "string",
                "format": "date-time"
              },
              "action": {
                "type": "string",
                "description": "Action taken or context switch"
              },
              "context": {
                "type": "string",
                "description": "Context at time of action"
              }
            },
            "required": ["timestamp", "action"]
          },
          "maxItems": 50,
          "description": "Navigation breadcrumbs for session"
        }
      },
      "additionalProperties": false
    },
    "tool_state": {
      "type": "object",
      "properties": {
        "active_tools": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string",
                "description": "Tool name"
              },
              "status": {
                "type": "string",
                "enum": ["active", "idle", "error", "disabled"],
                "description": "Current tool status"
              },
              "last_used": {
                "type": "string",
                "format": "date-time"
              },
              "usage_count": {
                "type": "number",
                "minimum": 0,
                "description": "Times used in this session"
              },
              "configuration": {
                "type": "object",
                "description": "Tool-specific configuration"
              }
            },
            "required": ["name", "status", "last_used"]
          }
        },
        "bash_sessions": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "session_id": {
                "type": "string",
                "description": "Bash session identifier"
              },
              "working_directory": {
                "type": "string",
                "description": "Current working directory for this bash session"
              },
              "status": {
                "type": "string",
                "enum": ["active", "idle", "terminated"],
                "description": "Bash session status"
              },
              "last_command": {
                "type": "string",
                "description": "Last command executed"
              },
              "environment_variables": {
                "type": "object",
                "additionalProperties": {
                  "type": "string"
                },
                "description": "Session-specific environment variables (non-sensitive)"
              }
            },
            "required": ["session_id", "working_directory", "status"]
          }
        },
        "file_watchers": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "path": {
                "type": "string",
                "description": "Path being watched"
              },
              "pattern": {
                "type": "string",
                "description": "File pattern or glob"
              },
              "events": {
                "type": "array",
                "items": {
                  "type": "string",
                  "enum": ["create", "modify", "delete", "move"]
                },
                "description": "Events being watched for"
              },
              "active": {
                "type": "boolean",
                "description": "Whether watcher is currently active"
              }
            },
            "required": ["path", "events", "active"]
          }
        }
      },
      "additionalProperties": false
    },
    "preferences": {
      "type": "object",
      "properties": {
        "auto_save": {
          "type": "boolean",
          "default": true,
          "description": "Automatically save session state"
        },
        "sync_interval": {
          "type": "number",
          "minimum": 30,
          "maximum": 3600,
          "default": 300,
          "description": "Sync interval in seconds"
        },
        "max_history": {
          "type": "number",
          "minimum": 10,
          "maximum": 1000,
          "default": 100,
          "description": "Maximum number of history items to keep"
        },
        "privacy_mode": {
          "type": "boolean",
          "default": false,
          "description": "Enable privacy mode (excludes sensitive data from sync)"
        }
      },
      "additionalProperties": false
    }
  },
  "required": ["session_info", "working_directory"],
  "additionalProperties": false
}